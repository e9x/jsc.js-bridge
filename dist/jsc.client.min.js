/*! For license information please see jsc.client.min.js.LICENSE.txt */
var JSC;(()=>{var e={'./Base.js':(e,t,r)=>{var s=r('./Events.js');e.exports=class{constructor(){this.eventp=new s}}},'./Client.js':(e,t,r)=>{'use strict';var s=r('./Base.js'),i=(r('./IPC.js'),r('./ClientContext.js'));e.exports=new class extends s{constructor(){super();var e=globalThis.jsc_emit;delete globalThis.jsc_emit,this.context=new i(this,CONTEXT_ID,e)}}},'./ClientContext.js':(e,t,r)=>{'use strict';var s=r('./Host.js');e.exports=class extends s{constructor(e,t,r){super({eval:()=>{},id:t,send(...e){r(JSON.stringify([this.id,...e]))}})}}},'./Events.js':e=>{'use strict';class t{static resolve_list(e,r){this.listeners||(this.listeners=Symbol());var s=(e[t.listeners]||(e[t.listeners]={}))[r]||(e[t.listeners][r]=[]);return s.merged||(s.merged=!0,e.constructor.hasOwnProperty(t.listeners)&&s.push(...t.resolve_list(e.constructor,r))),s}on(e,r){t.resolve_list(this,e).push(r)}once(e,r){var s=(...t)=>{this.off(e,s),r.call(this,...t)};s[t.original_func]=r,this.on(e,r)}off(e,r){if('function'!=typeof r)throw new Error('callback is not a function');r[t.original_func]&&(r=r[t.original_func]);var s=t.resolve_list(this,e),i=s.indexOf(r);-1!=i&&s.splice(i,1),s.length||delete this[t.listeners][e]}emit(e,...r){var s=t.resolve_list(this,e);if(s.length)for(var i of s)try{i.call(this,...r)}catch(e){this.emit('error',e)}else if(delete this[t.listeners][e],'error'==e)throw r[0]}}e.exports=t},'./Handle.js':e=>{'use strict';e.exports=class{constructor(e,t,r){this.host=e,this.id=t,this.base=r}apply(e,t,r){return this.host.ref_read(this.host.ipc.post('ref_apply',this.id,this.host.ref_create(t),r.length?this.host.ref_create(r):['json',[]]),!0)}construct(e,t,r){return this.host.ref_read(this.host.ipc.post('ref_construct',this.id,this.host.ref_create(t),this.host.ref_create(r)),!0)}get(e,t,r){return this.host.ref_read(this.host.ipc.post('ref_get',this.id,this.host.ref_create(t),this.host.ref_create(r)),!0)}set(e,t,r){return this.host.ref_read(this.host.ipc.post('ref_set',this.id,this.host.ref_create(t),this.host.ref_create(r)),!0)}getOwnPropertyDescriptor(e,t){var r=this.host.ref_read(this.host.ipc.post('ref_get_desc',this.id,this.host.ref_create(t)));return'object'==typeof r?Object.fromEntries(r):r}defineProperty(e,t,r){return this.host.ref_read(this.host.ipc.post('ref_set_desc',this.id,this.host.ref_create(t),this.host.ref_create(Object.entries(r))))}deleteProperty(e,t){return this.host.ref_read(this.host.ipc.post('ref_delete_prop',this.id,this.host.create_ref(),!0))}getPrototypeOf(e){return this.host.ref_read(this.host.ipc.post('ref_get_proto',this.id),!0)}setPrototypeOf(e,t){return this.host.ref_read(this.host.ipc.post('ref_set_proto',this.id,this.host.ref_create(t)),!0)}has(e,t){return this.host.ipc.post('ref_has',this.id,this.host.ref_create(t))}ownKeys(e){return[...new Set([...this.host.ref_read(this.host.ipc.post('ref_ownkeys',this.id),!0)].concat(Reflect.ownKeys(this.base)))]}}},'./Host.js':(e,t,r)=>{'use strict';var s=r('./Refs.js'),i=r('./Events.js'),o=r('./IPC.js');e.exports=class extends i{constructor(e){super(),this.$=e,this.ipc=new o(this.$.send.bind(this.$)),this.refs=new s(this.ipc),this.refs.ref_create(globalThis),this.refs.ref_create(this),this.bridge=this.refs.ref_handle(1),this.global=this.refs.ref_handle(2),this.native={error:e=>{if(e instanceof this.bridge.Error){new(e.name in globalThis?globalThis[e.name]:Error);return e.name+': '+e.message+'\n'+e.stack}return e}},this.bytecode={compile:e=>{var t=this.$.compile_bytecode(e),r=new Uint8Array(t.length/2);for(let e=0;e<t.length;e+=2)r[e/2]=parseInt(t.substr(e,2),16);return r},load:e=>{if(Array.isArray(e))e=new Uint8Array(e);else if(e instanceof ArrayBuffer)e=new Uint8Array(e);else if(!(e instanceof Uint8Array))throw new TypeError('JSC.bytecode.load only accepts: ArrayBuffer, Uint8Array, Array');if(!e.byteLength)throw new Error('Invalid bytecode');var t='';for(let r of e)t+=(255&r).toString(16).toUpperCase().padStart(2,0);this.$.eval_bytecode(t)}}}debugger(){this.eval('debugger;')}execute(e,...t){if('function'!=typeof e){let t=this.refs.ref_read(this.ipc.post('eval',e));if(t.thrown)throw this.native.error(t.data);return t.data}{let r=this.refs.ref_read(this.ipc.post('eval','('+e+')'));if(r.thrown)throw this.refs.native.error(r.data);try{return r.data(...t)}catch(e){throw console.log(e),this.refs.native.error(e)}}}json(e){return this.bridge.JSON.parse(JSON.stringify(e))}}},'./IPC.js':(e,t,r)=>{'use strict';var s=r('./Events.js');e.exports=class extends s{constructor(e){super(),this.send=e,this.on('post',((e,t,...r)=>{this.emit(t,(t=>this.send(e,t)),...r)}))}post(...e){var t,r=Math.random();return this.once(r,(e=>t=e)),this.send('post',r,...e),t}}},'./Refs.js':(e,t,r)=>{'use strict';var s=r('./Handle.js');class i{constructor(e){this.ipc=e,this.base_func=Object.setPrototypeOf((function(){}),null),this.base_obj=Object.setPrototypeOf({},null);var t=Object.getOwnPropertyDescriptors(this.base_func);for(let e in t){let r=t[e];r.configurable&&(Object.defineProperty(this.base_func,e,{writable:!0}),delete this.base_func[e])}Object.defineProperty(this.base_func,'toString',{value:()=>'[JSC Function]',writable:!0}),this.proxies=new WeakMap,this.needs_handle=['function','object'],this.symbols=['search','match','matchAll','replace','species','split','toPrimitive','toStringTag','unscopables','asyncIterator','hasInstance','isConcatSpreadable','iterator'],this.ipc.on('eval',((e,t)=>{var r={thrown:!1,data:void 0};try{r.data=eval(t)}catch(e){r.thrown=!0,r.data=e}e(this.ref_create(r))})),this.ipc.on('ref_get',((e,t,r,s)=>{var i,o;t=this.ref_resolve(t),r=this.ref_read(r),s=this.ref_read(s);try{i=Reflect.get(t,r,s)}catch(e){i=e,o=!0}e(this.ref_create(i,o))})),this.ipc.on('ref_set',((e,t,r,s)=>{var i,o;t=this.ref_resolve(t),r=this.ref_read(r),s=this.ref_read(s);try{i=Reflect.set(t,r,s)}catch(e){i=e,o=!0}e(this.ref_create(i,o))})),this.ipc.on('ref_apply',((e,t,r,s)=>{var i,o;t=this.ref_resolve(t),r=this.ref_read(r),s=(s=this.ref_read(s)).length?[...s]:[];try{i=Reflect.apply(t,r,s)}catch(e){i=e,o=!0}e(this.ref_create(i,o))})),this.ipc.on('ref_construct',((e,t,r,s)=>{var i,o;r=[...this.ref_read(r)],s=this.ref_read(s),t=this.ref_resolve(t);try{i=Reflect.construct(t,r,s)}catch(e){i=e,o=!0}e(this.ref_create(i,o))})),this.ipc.on('ref_has',((e,t,r)=>{var s,i;t=this.ref_resolve(t),r=this.ref_read(r);try{s=Reflect.has(t,r)}catch(e){s=e,i=!0}e(this.ref_create(s,i))})),this.ipc.on('ref_get_proto',((e,t)=>{var r,s;try{r=Reflect.getPrototypeOf(this.ref_resolve(t))}catch(e){r=e,s=!0}e(this.ref_create(r,s))})),this.ipc.on('ref_set_proto',((e,t,r)=>{var s,i;try{s=Reflect.setPrototypeOf(this.ref_resolve(t),this.ref_read(r))}catch(e){s=e,i=!0}e(this.ref_create(s,i))})),this.ipc.on('ref_ownkeys',((e,t)=>{var r,s;try{r=Reflect.ownKeys(this.ref_resolve(t))}catch(e){r=e,s=!0}e(this.ref_create(r,s))})),this.ipc.on('ref_get_desc',((e,t,r)=>{var s,i;t=this.ref_resolve(t),r=this.ref_read(r);try{s=Object.entries(Reflect.getOwnPropertyDescriptor(t,r))}catch(e){s=e,i=!0}e(this.ref_create(s,i))})),this.ipc.on('ref_set_desc',((e,t,r,s)=>{var i,o;t=this.ref_resolve(t),r=this.ref_read(r),s=this.ref_read(s);try{i=Reflect.defineProperty(t,r,Object.fromEntries(s))}catch(e){i=e,o=!0}e(this.ref_create(i,o))})),this.ipc.on('ref_delete_prop',((e,t,r)=>{var s,i;t=this.ref_resolve(t),r=this.ref_read(r);try{s=Reflect.deleteProperty(t,r)}catch(e){s=e,i=!0}e(this.ref_create(s,i))})),this.refs=new Map,this.ref_create(this),this.global=this.ref_handle(0)}noop(){}ref_delete(e){return this.refs.delete(e)}ref_resolve(e){return this.refs.get(e)}ref_create(e,t=!1){var r=[typeof e,e,t];for(let[t,s]of this.refs)if(e===s)return r[1]=t,r;if(this.proxies.has(e))return r[0]='ref',r[1]=this.proxies.get(e),r;if('symbol'==typeof e){for(let t of this.symbols)if(Symbol[t]==e)return r[0]='symbol_res',r[1]=t,r;console.warn('Could not create symbol:',e)}return null===e?(r[0]='json',r[1]=null,r):this.needs_handle.includes(typeof e)?(r[1]=this.refs.size,this.refs.set(r[1],e),r):r}ref_read([e,t,r],s){var i;if(i='undefined'==e?void 0:'symbol_res'==e&&'string'==typeof t?Symbol[t]:'ref'==e?this.ref_resolve(t):this.needs_handle.includes(e)?this.ref_handle(t,e):t,r&&s)throw i;return i}ref_handle(e,t='object'){var r='function'==t?this.base_func:this.base_obj,i=new Proxy(r,new s(this,e,r));return this.proxies.set(i,e),i}}e.exports=i}},t={};function r(s){var i=t[s];if(void 0!==i)return i.exports;var o=t[s]={exports:{}};return e[s](o,o.exports,r),o.exports}var s=r('./Client.js');JSC=s})();