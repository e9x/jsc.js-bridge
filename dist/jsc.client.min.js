/*! For license information please see jsc.client.min.js.LICENSE.txt */
var JSC;(()=>{'use strict';var e={'./Bridge.js':(e,t,r)=>{var s=r('./Handle.js');class i{constructor(e){this.host=e,this.ipc=this.host.ipc,this.base_func=Object.setPrototypeOf((function(){}),null),this.base_obj=Object.setPrototypeOf({},null);var t=Object.getOwnPropertyDescriptors(this.base_func);for(let e in t){let r=t[e];r.configurable&&(Object.defineProperty(this.base_func,e,{writable:!0}),delete this.base_func[e])}Object.defineProperty(this.base_func,'toString',{value:()=>'[JSC Function]',writable:!0}),this.proxies=new WeakMap,this.needs_handle=['function','object'],this.symbols=['search','match','matchAll','replace','species','split','toPrimitive','toStringTag','unscopables','asyncIterator','hasInstance','isConcatSpreadable','iterator'],this.ipc.on('eval',((e,t)=>{var r={thrown:!1,data:void 0};try{r.data=eval(t)}catch(e){r.thrown=!0,r.data=e}e(this.ref_create(r))})),this.ipc.on('ref_get',((e,t,r)=>{var s,i,o=this.ref_read(r),h=this.ref_resolve(t);try{s=Reflect.get(h,o)}catch(e){s=e,i=!0}e(this.ref_create(s,i))})),this.ipc.on('ref_set',((e,t,r,s)=>{var i,o,h=this.ref_read(r),a=this.ref_read(s),n=this.ref_resolve(t);try{i=Reflect.set(n,h,a)}catch(e){i=e,o=!0}e(this.ref_create(i,o))})),this.ipc.on('ref_apply',((e,t,r,s)=>{var i,o,h=this.ref_read(r),a=this.ref_read(s),n=this.ref_resolve(t),c=[];a.length&&(c=[...a]);try{i=Reflect.apply(n,h,c)}catch(e){i=e,o=!0}e(this.ref_create(i,o))})),this.ipc.on('ref_construct',((e,t,r,s)=>{var i,o,h=[...this.ref_read(r)],a=this.ref_read(s),n=this.ref_resolve(t);try{i=Reflect.construct(n,h,a)}catch(e){i=e,o=!0}e(this.ref_create(i,o))})),this.ipc.on('ref_has',((e,t,r)=>{var s,i;try{s=Reflect.has(this.ref_resolve(t),this.ref_read(r))}catch(e){s=e,i=!0}e(this.ref_create(s,i))})),this.ipc.on('ref_get_proto',((e,t)=>{var r,s;try{r=Reflect.getPrototypeOf(this.ref_resolve(t))}catch(e){r=e,s=!0}e(this.ref_create(r,s))})),this.ipc.on('ref_set_proto',((e,t,r)=>{var s,i;try{s=Reflect.setPrototypeOf(this.ref_resolve(t),this.ref_read(r))}catch(e){s=e,i=!0}e(this.ref_create(s,i))})),this.ipc.on('ref_ownkeys',((e,t)=>{var r,s;try{r=Reflect.ownKeys(this.ref_resolve(t))}catch(e){r=e,s=!0}e(this.ref_create(r,s))})),this.ipc.on('ref_desc',((e,t,r)=>{var s=Reflect.getOwnPropertyDescriptor(this.ref_resolve(t),this.ref_read(r));e(s?{writable:s.writable,configurable:s.configurable,enumerable:s.enumerable,value:s.value?'it exists':void 0,get:s.get?this.global.noop:void 0,set:s.set?this.global.noop:void 0}:s)})),this.refs=new Map,this.ref_create(this),this.global=this.ref_handle(0)}noop(){}ref_delete(e){return this.refs.delete(e)}ref_resolve(e){return this.refs.get(e)}ref_create(e,t=!1){var r=[typeof e,e,t];for(let[t,s]of this.refs)if(e===s)return r[1]=t,r;if(this.proxies.has(e))return r[0]='ref',r[1]=this.proxies.get(e),r;if('symbol'==typeof e){for(let t of this.symbols)if(Symbol[t]==e)return r[0]='symbol_res',r[1]=t,r;console.warn('Could not create symbol:',e)}return null===e?(r[0]='json',r[1]=null,r):this.needs_handle.includes(typeof e)?(r[1]=this.refs.size,this.refs.set(r[1],e),r):r}ref_read([e,t,r],s){var i;if(i='undefined'==e?void 0:'symbol_res'==e&&'string'==typeof t?Symbol[t]:'ref'==e?this.ref_resolve(t):this.needs_handle.includes(e)?this.ref_handle(t,e):t,r&&s)throw this.native_error(i);return i}ref_handle(e,t='object'){var r='function'==t?this.base_func:this.base_obj,i=new Proxy(r,new s(this,e,r));return this.proxies.set(i,e),i}native_error(e){if(e instanceof this.host.context.Error){return new(e.name in globalThis?globalThis[e.name]:Error)(e.message+e.stack)}return e}}e.exports=i},'./Client.js':(e,t,r)=>{var s=r('./Host.js');e.exports=new class extends s{constructor(){var e=globalThis.jsc_emit;delete globalThis.jsc_emit,super(((...t)=>e(JSON.stringify(t)))),globalThis.console_log=console.log=(...e)=>this.ipc.send('log',...e),this.ready.then((()=>{var e=this.context.console;for(let t of['log','error','warn','debug','trace'])globalThis.console[t]='error'==t?(...r)=>{try{e[t]('[SUB]',...r.map((e=>this.bridge.global.native_error(e))))}catch(e){console_log(e+'')}}:e[t].bind(e,'[SUB]')}))}}},'./Events.js':e=>{class t{static resolve_list(e,r){this.listeners||(this.listeners=Symbol());var s=(e[t.listeners]||(e[t.listeners]={}))[r]||(e[t.listeners][r]=[]);return s.merged||(s.merged=!0,e.constructor.hasOwnProperty(t.listeners)&&s.push(...t.resolve_list(e.constructor,r))),s}on(e,r){t.resolve_list(this,e).push(r)}once(e,r){var s=(...t)=>{this.off(e,s),r.call(this,...t)};s[t.original_func]=r,this.on(e,r)}off(e,r){if('function'!=typeof r)throw new Error('callback is not a function');r[t.original_func]&&(r=r[t.original_func]);var s=t.resolve_list(this,e),i=s.indexOf(r);-1!=i&&s.splice(i,1),s.length||delete this[t.listeners][e]}emit(e,...r){var s=t.resolve_list(this,e);if(s.length)for(var i of s)try{i.call(this,...r)}catch(e){this.emit('error',e)}else if(delete this[t.listeners][e],'error'==e)throw r[0]}}e.exports=t},'./Handle.js':e=>{e.exports=class{constructor(e,t,r){this.host=e,this.id=t,this.base=r}apply(e,t,r){return this.host.ref_read(this.host.ipc.post('ref_apply',this.id,this.host.ref_create(t),r.length?this.host.ref_create(r):['json',[]]),!0)}construct(e,t,r){return this.host.ref_read(this.host.ipc.post('ref_construct',this.id,this.host.ref_create(t),this.host.ref_create(r)),!0)}get(e,t){return this.host.ref_read(this.host.ipc.post('ref_get',this.id,this.host.ref_create(t)),!0)}set(e,t,r){return this.host.ref_read(this.host.ipc.post('ref_set',this.id,this.host.ref_create(t),this.host.ref_create(r)),!0)}getOwnPropertyDescriptor(e,t){return this.host.ipc.post('ref_desc',this.id,this.host.ref_create(t))||void 0}getPrototypeOf(e){return this.host.ref_read(this.host.ipc.post('ref_get_proto',this.id),!0)}setPrototypeOf(e,t){return this.host.ref_read(this.host.ipc.post('ref_set_proto',this.id,this.host.ref_create(t)),!0)}has(e,t){return this.host.ipc.post('ref_has',this.id,this.host.ref_create(t))}ownKeys(e){return[...new Set([...this.host.ref_read(this.host.ipc.post('ref_ownkeys',this.id),!0)].concat(Reflect.ownKeys(this.base)))]}}},'./Host.js':(e,t,r)=>{var s=r('./Bridge.js'),i=r('./IPC.js');e.exports=class{constructor(e){this.ipc=new i(e);var t={};Object.assign(this.ready=new Promise(((e,r)=>t={resolve:e,reject:r})),t),this.bridge=new s(this),this.bridge.ref_create(globalThis),this.bridge.ref_create(this),this.context=this.bridge.ref_handle(1),this.global=this.bridge.ref_handle(2),this.ipc.on('ready',(()=>{this.ready.resolve()}))}debugger(){this.eval('debugger;')}eval(e,...t){if('function'!=typeof e){let t=this.bridge.ref_read(this.ipc.post('eval',e));if(t.thrown)throw this.bridge.native_error(t.data);return t.data}{let r=this.bridge.ref_read(this.ipc.post('eval','('+e+')'));if(r.thrown)throw this.bridge.native_error(r.data);try{return r.data(...t)}catch(e){throw console.log(e),this.bridge.native_error(e)}}}json(e){return this.context.JSON.parse(JSON.stringify(e))}}},'./IPC.js':(e,t,r)=>{var s=r('./Events.js');e.exports=class extends s{constructor(e){super(),this.send=e,this.on('post',((e,t,...r)=>{this.emit(t,(t=>this.send(e,t)),...r)}))}post(...e){var t,r=Math.random();return this.once(r,(e=>t=e)),this.send('post',r,...e),t}}}},t={};function r(s){var i=t[s];if(void 0!==i)return i.exports;var o=t[s]={exports:{}};return e[s](o,o.exports,r),o.exports}var s=r('./Client.js');JSC=s})();